"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.fromRau = fromRau;
exports.toRau = toRau;
exports.fromUtf8 = fromUtf8;
exports.toUtf8 = toUtf8;
exports.isHexStrict = isHexStrict;
exports.hexToBytes = hexToBytes;
exports.validateAddress = validateAddress;

var _bech = _interopRequireDefault(require("bech32"));

var _bignumber = require("bignumber.js");

var _utf = require("utf8");

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * fromRau is a function to convert Rau to Iotx.
 * @param rau number of Rau in string
 * @param unit unit converts to
 * @returns number of unit
 */
function fromRau(rau, unit) {
  return convert(rau, unit, "div");
}
/**
 * toRau is a function to convert various units to Rau.
 * @param num is the number of unit
 * @param unit is the unit to convert to Rau.
 * @returns number of Rau
 */

function toRau(num, unit) {
  return convert(num, unit, "multipliedBy");
}

function convert(num, unit, operator) {
  const rauBN = new _bignumber.BigNumber(num);

  switch (unit) {
    case "Rau":
      return num;

    case "KRau":
      // @ts-ignore
      return rauBN[operator](new _bignumber.BigNumber("1000")).toString(10);

    case "MRau":
      // @ts-ignore
      return rauBN[operator](new _bignumber.BigNumber("1000000")).toString(10);

    case "GRau":
      // @ts-ignore
      return rauBN[operator](new _bignumber.BigNumber("1000000000")).toString(
        10
      );

    case "Qev":
      // @ts-ignore
      return rauBN[operator](
        new _bignumber.BigNumber("1000000000000")
      ).toString(10);

    case "Jing":
      // @ts-ignore
      return rauBN[operator](
        new _bignumber.BigNumber("1000000000000000")
      ).toString(10);

    default:
      // @ts-ignore
      return rauBN[operator](
        new _bignumber.BigNumber("1000000000000000000")
      ).toString(10);
  }
}
/**
 * Should be called to get hex representation of utf8 string
 *
 * @param value input string
 * @returns hex representation of input string
 */

function fromUtf8(value) {
  let eValue = (0, _utf.encode)(value);
  let hex = ""; // remove \u0000 padding from either side

  eValue = eValue.replace(/^(?:\u0000)*/, "");
  eValue = eValue
    .split("")
    .reverse()
    .join("");
  eValue = eValue.replace(/^(?:\u0000)*/, "");
  eValue = eValue
    .split("")
    .reverse()
    .join("");

  for (let i = 0; i < eValue.length; i++) {
    const code = eValue.charCodeAt(i);
    const n = code.toString(16);
    hex += n.length < 2 ? `0${n}` : n;
  }

  return `${hex}`;
}
/**
 * Should be called to get utf8 from it's hex representation
 *
 * @param hex hex string
 *
 * @returns ascii string representation of hex value
 */

function toUtf8(hex) {
  if (!isHexStrict(hex)) {
    throw new Error(`The parameter "${hex}" must be a valid HEX string.`);
  }

  let result = "";
  let code = 0;
  let eHex = hex; // remove 00 padding from either side

  eHex = eHex.replace(/^(?:00)*/, "");
  eHex = eHex
    .split("")
    .reverse()
    .join("");
  eHex = eHex.replace(/^(?:00)*/, "");
  eHex = eHex
    .split("")
    .reverse()
    .join("");
  const l = eHex.length;

  for (let i = 0; i < l; i += 2) {
    code = parseInt(eHex.substr(i, 2), 16);
    result += String.fromCharCode(code);
  }

  return (0, _utf.decode)(result);
}
/**
 * Check if string is HEX, requires a 0x in front
 *
 * @param hex to be checked
 * @returns is hex
 */

function isHexStrict(hex) {
  return /^(-)?[0-9a-f]*$/i.test(hex);
}
/**
 * Convert a hex string to a byte array
 *
 * @param hex string
 *
 * @returns  the byte array
 */

function hexToBytes(hex) {
  if (!isHexStrict(hex)) {
    throw new Error(`Given value "${hex}" is not a valid hex string.`);
  }

  const shex = hex.length % 2 ? `0${hex}` : hex;
  const bytes = [];

  for (let c = 0; c < shex.length; c += 2) {
    bytes.push(parseInt(shex.substr(c, 2), 16));
  }

  return new Uint8Array(bytes);
}
/**
 * validate address for iotex.
 *
 * @param address address
 *
 * @returns validate result
 */

function validateAddress(address) {
  try {
    const payload = _bech.default.decode(address);

    return payload.prefix === "io";
  } catch (e) {
    return false;
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9hY2NvdW50L3V0aWxzLnRzIl0sIm5hbWVzIjpbImZyb21SYXUiLCJyYXUiLCJ1bml0IiwiY29udmVydCIsInRvUmF1IiwibnVtIiwib3BlcmF0b3IiLCJyYXVCTiIsIkJpZ051bWJlciIsInRvU3RyaW5nIiwiZnJvbVV0ZjgiLCJ2YWx1ZSIsImVWYWx1ZSIsImhleCIsInJlcGxhY2UiLCJzcGxpdCIsInJldmVyc2UiLCJqb2luIiwiaSIsImxlbmd0aCIsImNvZGUiLCJjaGFyQ29kZUF0IiwibiIsInRvVXRmOCIsImlzSGV4U3RyaWN0IiwiRXJyb3IiLCJyZXN1bHQiLCJlSGV4IiwibCIsInBhcnNlSW50Iiwic3Vic3RyIiwiU3RyaW5nIiwiZnJvbUNoYXJDb2RlIiwidGVzdCIsImhleFRvQnl0ZXMiLCJzaGV4IiwiYnl0ZXMiLCJjIiwicHVzaCIsIlVpbnQ4QXJyYXkiLCJ2YWxpZGF0ZUFkZHJlc3MiLCJhZGRyZXNzIiwicGF5bG9hZCIsImJlY2gzMiIsImRlY29kZSIsInByZWZpeCIsImUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7OztBQUVBOzs7Ozs7QUFNTyxTQUFTQSxPQUFULENBQWlCQyxHQUFqQixFQUE4QkMsSUFBOUIsRUFBb0Q7QUFDekQsU0FBT0MsT0FBTyxDQUFDRixHQUFELEVBQU1DLElBQU4sRUFBWSxLQUFaLENBQWQ7QUFDRDtBQUVEOzs7Ozs7OztBQU1PLFNBQVNFLEtBQVQsQ0FBZUMsR0FBZixFQUE0QkgsSUFBNUIsRUFBa0Q7QUFDdkQsU0FBT0MsT0FBTyxDQUFDRSxHQUFELEVBQU1ILElBQU4sRUFBWSxjQUFaLENBQWQ7QUFDRDs7QUFFRCxTQUFTQyxPQUFULENBQWlCRSxHQUFqQixFQUE4QkgsSUFBOUIsRUFBNENJLFFBQTVDLEVBQXNFO0FBQ3BFLFFBQU1DLEtBQUssR0FBRyxJQUFJQyxvQkFBSixDQUFjSCxHQUFkLENBQWQ7O0FBQ0EsVUFBUUgsSUFBUjtBQUNFLFNBQUss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O0FBQ0EsT0FBSyxJQUFJQyxDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHRixJQUFJLENBQUNoQixNQUF6QixFQUFpQ2tCLENBQUMsSUFBSSxDQUF0QyxFQUF5QztBQUN2Q0QsSUFBQUEsS0FBSyxDQUFDRSxJQUFOLENBQVdULFFBQVEsQ0FBQ00sSUFBSSxDQUFDTCxNQUFMLENBQVlPLENBQVosRUFBZSxDQUFmLENBQUQsRUFBb0IsRUFBcEIsQ0FBbkI7QUFDRDs7QUFFRCxTQUFPLElBQUlFLFVBQUosQ0FBZUgsS0FBZixDQUFQO0FBQ0Q7QUFFRDs7Ozs7Ozs7O0FBT08sU0FBU0ksZUFBVCxDQUF5QkMsT0FBekIsRUFBbUQ7QUFDeEQsTUFBSTtBQUNGLFVBQU1DLE9BQU8sR0FBR0MsY0FBT0MsTUFBUCxDQUFjSCxPQUFkLENBQWhCOztBQUNBLFdBQU9DLE9BQU8sQ0FBQ0csTUFBUixLQUFtQixJQUExQjtBQUNELEdBSEQsQ0FHRSxPQUFPQyxDQUFQLEVBQVU7QUFDVixXQUFPLEtBQVA7QUFDRDtBQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGJlY2gzMiBmcm9tIFwiYmVjaDMyXCI7XG5pbXBvcnQgeyBCaWdOdW1iZXIgfSBmcm9tIFwiYmlnbnVtYmVyLmpzXCI7XG5pbXBvcnQgeyBkZWNvZGUsIGVuY29kZSB9IGZyb20gXCJ1dGY4XCI7XG5cbi8qKlxuICogZnJvbVJhdSBpcyBhIGZ1bmN0aW9uIHRvIGNvbnZlcnQgUmF1IHRvIElvdHguXG4gKiBAcGFyYW0gcmF1IG51bWJlciBvZiBSYXUgaW4gc3RyaW5nXG4gKiBAcGFyYW0gdW5pdCB1bml0IGNvbnZlcnRzIHRvXG4gKiBAcmV0dXJucyBudW1iZXIgb2YgdW5pdFxuICovXG5leHBvcnQgZnVuY3Rpb24gZnJvbVJhdShyYXU6IHN0cmluZywgdW5pdDogc3RyaW5nKTogc3RyaW5nIHtcbiAgcmV0dXJuIGNvbnZlcnQocmF1LCB1bml0LCBcImRpdlwiKTtcbn1cblxuLyoqXG4gKiB0b1JhdSBpcyBhIGZ1bmN0aW9uIHRvIGNvbnZlcnQgdmFyaW91cyB1bml0cyB0byBSYXUuXG4gKiBAcGFyYW0gbnVtIGlzIHRoZSBudW1iZXIgb2YgdW5pdFxuICogQHBhcmFtIHVuaXQgaXMgdGhlIHVuaXQgdG8gY29udmVydCB0byBSYXUuXG4gKiBAcmV0dXJucyBudW1iZXIgb2YgUmF1XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB0b1JhdShudW06IHN0cmluZywgdW5pdDogc3RyaW5nKTogc3RyaW5nIHtcbiAgcmV0dXJuIGNvbnZlcnQobnVtLCB1bml0LCBcIm11bHRpcGxpZWRCeVwiKTtcbn1cblxuZnVuY3Rpb24gY29udmVydChudW06IHN0cmluZywgdW5pdDogc3RyaW5nLCBvcGVyYXRvcjogc3RyaW5nKTogc3RyaW5nIHtcbiAgY29uc3QgcmF1Qk4gPSBuZXcgQmlnTnVtYmVyKG51bSk7XG4gIHN3aXRjaCAodW5pdCkge1xuICAgIGNhc2UgXCJSYXVcIjpcbiAgICAgIHJldHVybiBudW07XG4gICAgY2FzZSBcIktSYXVcIjpcbiAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgIHJldHVybiByYXVCTltvcGVyYXRvcl0obmV3IEJpZ051bWJlcihcIjEwMDBcIikpLnRvU3RyaW5nKDEwKTtcbiAgICBjYXNlIFwiTVJhdVwiOlxuICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgcmV0dXJuIHJhdUJOW29wZXJhdG9yXShuZXcgQmlnTnVtYmVyKFwiMTAwMDAwMFwiKSkudG9TdHJpbmcoMTApO1xuICAgIGNhc2UgXCJHUmF1XCI6XG4gICAgICAvLyBAdHMtaWdub3JlXG4gICAgICByZXR1cm4gcmF1Qk5bb3BlcmF0b3JdKG5ldyBCaWdOdW1iZXIoXCIxMDAwMDAwMDAwXCIpKS50b1N0cmluZygxMCk7XG4gICAgY2FzZSBcIlFldlwiOlxuICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgcmV0dXJuIHJhdUJOW29wZXJhdG9yXShuZXcgQmlnTnVtYmVyKFwiMTAwMDAwMDAwMDAwMFwiKSkudG9TdHJpbmcoMTApO1xuICAgIGNhc2UgXCJKaW5nXCI6XG4gICAgICAvLyBAdHMtaWdub3JlXG4gICAgICByZXR1cm4gcmF1Qk5bb3BlcmF0b3JdKG5ldyBCaWdOdW1iZXIoXCIxMDAwMDAwMDAwMDAwMDAwXCIpKS50b1N0cmluZygxMCk7XG4gICAgZGVmYXVsdDpcbiAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgIHJldHVybiByYXVCTltvcGVyYXRvcl0obmV3IEJpZ051bWJlcihcIjEwMDAwMDAwMDAwMDAwMDAwMDBcIikpLnRvU3RyaW5nKDEwKTtcbiAgfVxufVxuXG4vKipcbiAqIFNob3VsZCBiZSBjYWxsZWQgdG8gZ2V0IGhleCByZXByZXNlbnRhdGlvbiBvZiB1dGY4IHN0cmluZ1xuICpcbiAqIEBwYXJhbSB2YWx1ZSBpbnB1dCBzdHJpbmdcbiAqIEByZXR1cm5zIGhleCByZXByZXNlbnRhdGlvbiBvZiBpbnB1dCBzdHJpbmdcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGZyb21VdGY4KHZhbHVlOiBzdHJpbmcpOiBzdHJpbmcge1xuICBsZXQgZVZhbHVlID0gZW5jb2RlKHZhbHVlKTtcbiAgbGV0IGhleCA9IFwiXCI7XG5cbiAgLy8gcmVtb3ZlIFxcdTAwMDAgcGFkZGluZyBmcm9tIGVpdGhlciBzaWRlXG4gIGVWYWx1ZSA9IGVWYWx1ZS5yZXBsYWNlKC9eKD86XFx1MDAwMCkqLywgXCJcIik7XG4gIGVWYWx1ZSA9IGVWYWx1ZVxuICAgIC5zcGxpdChcIlwiKVxuICAgIC5yZXZlcnNlKClcbiAgICAuam9pbihcIlwiKTtcbiAgZVZhbHVlID0gZVZhbHVlLnJlcGxhY2UoL14oPzpcXHUwMDAwKSovLCBcIlwiKTtcbiAgZVZhbHVlID0gZVZhbHVlXG4gICAgLnNwbGl0KFwiXCIpXG4gICAgLnJldmVyc2UoKVxuICAgIC5qb2luKFwiXCIpO1xuXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgZVZhbHVlLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgY29kZSA9IGVWYWx1ZS5jaGFyQ29kZUF0KGkpO1xuICAgIGNvbnN0IG4gPSBjb2RlLnRvU3RyaW5nKDE2KTtcbiAgICBoZXggKz0gbi5sZW5ndGggPCAyID8gYDAke259YCA6IG47XG4gIH1cblxuICByZXR1cm4gYCR7aGV4fWA7XG59XG5cbi8qKlxuICogU2hvdWxkIGJlIGNhbGxlZCB0byBnZXQgdXRmOCBmcm9tIGl0J3MgaGV4IHJlcHJlc2VudGF0aW9uXG4gKlxuICogQHBhcmFtIGhleCBoZXggc3RyaW5nXG4gKlxuICogQHJldHVybnMgYXNjaWkgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGhleCB2YWx1ZVxuICovXG5leHBvcnQgZnVuY3Rpb24gdG9VdGY4KGhleDogc3RyaW5nKTogc3RyaW5nIHtcbiAgaWYgKCFpc0hleFN0cmljdChoZXgpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgcGFyYW1ldGVyIFwiJHtoZXh9XCIgbXVzdCBiZSBhIHZhbGlkIEhFWCBzdHJpbmcuYCk7XG4gIH1cblxuICBsZXQgcmVzdWx0ID0gXCJcIjtcbiAgbGV0IGNvZGUgPSAwO1xuICBsZXQgZUhleCA9IGhleDtcblxuICAvLyByZW1vdmUgMDAgcGFkZGluZyBmcm9tIGVpdGhlciBzaWRlXG4gIGVIZXggPSBlSGV4LnJlcGxhY2UoL14oPzowMCkqLywgXCJcIik7XG4gIGVIZXggPSBlSGV4XG4gICAgLnNwbGl0KFwiXCIpXG4gICAgLnJldmVyc2UoKVxuICAgIC5qb2luKFwiXCIpO1xuICBlSGV4ID0gZUhleC5yZXBsYWNlKC9eKD86MDApKi8sIFwiXCIpO1xuICBlSGV4ID0gZUhleFxuICAgIC5zcGxpdChcIlwiKVxuICAgIC5yZXZlcnNlKClcbiAgICAuam9pbihcIlwiKTtcblxuICBjb25zdCBsID0gZUhleC5sZW5ndGg7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgbDsgaSArPSAyKSB7XG4gICAgY29kZSA9IHBhcnNlSW50KGVIZXguc3Vic3RyKGksIDIpLCAxNik7XG4gICAgcmVzdWx0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoY29kZSk7XG4gIH1cblxuICByZXR1cm4gZGVjb2RlKHJlc3VsdCk7XG59XG5cbi8qKlxuICogQ2hlY2sgaWYgc3RyaW5nIGlzIEhFWCwgcmVxdWlyZXMgYSAweCBpbiBmcm9udFxuICpcbiAqIEBwYXJhbSBoZXggdG8gYmUgY2hlY2tlZFxuICogQHJldHVybnMgaXMgaGV4XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc0hleFN0cmljdChoZXg6IHN0cmluZyk6IGJvb2xlYW4ge1xuICByZXR1cm4gL14oLSk/WzAtOWEtZl0qJC9pLnRlc3QoaGV4KTtcbn1cblxuLyoqXG4gKiBDb252ZXJ0IGEgaGV4IHN0cmluZyB0byBhIGJ5dGUgYXJyYXlcbiAqXG4gKiBAcGFyYW0gaGV4IHN0cmluZ1xuICpcbiAqIEByZXR1cm5zICB0aGUgYnl0ZSBhcnJheVxuICovXG5leHBvcnQgZnVuY3Rpb24gaGV4VG9CeXRlcyhoZXg6IHN0cmluZyk6IFVpbnQ4QXJyYXkge1xuICBpZiAoIWlzSGV4U3RyaWN0KGhleCkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEdpdmVuIHZhbHVlIFwiJHtoZXh9XCIgaXMgbm90IGEgdmFsaWQgaGV4IHN0cmluZy5gKTtcbiAgfVxuXG4gIGNvbnN0IHNoZXggPSBoZXgubGVuZ3RoICUgMiA/IGAwJHtoZXh9YCA6IGhleDtcblxuICBjb25zdCBieXRlcyA9IFtdO1xuICBmb3IgKGxldCBjID0gMDsgYyA8IHNoZXgubGVuZ3RoOyBjICs9IDIpIHtcbiAgICBieXRlcy5wdXNoKHBhcnNlSW50KHNoZXguc3Vic3RyKGMsIDIpLCAxNikpO1xuICB9XG5cbiAgcmV0dXJuIG5ldyBVaW50OEFycmF5KGJ5dGVzKTtcbn1cblxuLyoqXG4gKiB2YWxpZGF0ZSBhZGRyZXNzIGZvciBpb3RleC5cbiAqXG4gKiBAcGFyYW0gYWRkcmVzcyBhZGRyZXNzXG4gKlxuICogQHJldHVybnMgdmFsaWRhdGUgcmVzdWx0XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZUFkZHJlc3MoYWRkcmVzczogc3RyaW5nKTogYm9vbGVhbiB7XG4gIHRyeSB7XG4gICAgY29uc3QgcGF5bG9hZCA9IGJlY2gzMi5kZWNvZGUoYWRkcmVzcyk7XG4gICAgcmV0dXJuIHBheWxvYWQucHJlZml4ID09PSBcImlvXCI7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn1cbiJdfQ==
